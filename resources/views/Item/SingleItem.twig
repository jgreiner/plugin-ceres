{% extends getPartial('page-design') %}
{% import "Ceres::PageDesign.Macros.LayoutContainer" as LayoutContainer %}

{% set itemData = config("Ceres.item.data") | split(', ') %}
{% set configItemName = config("Ceres.item.name") %}
{% set variations = services.item.getVariationAttributeMap( item.documents[0].data.item.id  ) %}
{% set basePriceList = getBasePriceList( services.item.getVariationList( item.documents[0].data.item.id  ) ) %}
{% set crossSellingList = services.item.getItemCrossSellingList( item.documents[0].data.item.id  ) %}

{% set paginatedResult      = services.itemLoader.loadForTemplate('Ceres::Category.Item.CategoryItem', itemLoaderPresets.categoryList, {'categoryId':16, 'page':1, 'itemsPerPage':4, 'facets': facetParams}) %}

{% set itemList             = paginatedResult.documents %}
{% set paginationType       = config("Ceres.pagination.position") %}

{% block PageBody %}


    <resource name="facetParams" :data="[]"></resource>
    <resource name="facets" :data="{{ paginatedResult.facets | json_encode }} || []"></resource>
    <resource name="itemList" :data="{}"></resource>

    {{ component( "Ceres::ItemList.Components.Filter.ItemFilterList") }}
    {{ component( "Ceres::ItemList.Components.ItemList") }}
    {{ component( "Ceres::Item.Components.VariationSelect" ) }}
    {{ component( "Ceres::Item.Components.ItemImageCarousel" ) }}
    {{ component( "Ceres::Basket.Components.AddToBasket" ) }}

    <resource name="currentVariation" :data="{{ item | json_encode() }}"></resource>

    <div class="single container-max page-content">
        <div class="row is-flex">
            <div class="col-md-3">
                <div class="sidebar-categories">
                    <div class="category-title">Kategorien</div>
                    <ul>
                        <li>
                            <a href="">Innenleuchten</a>
                            <ul>
                                <li><a href="">Pendelleuchten</a></li>
                                <li><a href="">Deckenleuchten</a></li>
                                <li>
                                    <a href="">Stehleuchten</a>
                                    <ul>
                                        <li><a href="">Wandleuchten</a></li>
                                        <li><a href="">Einbauleuchten</a></li>
                                        <li><a href="">Unterbauleuchten</a></li>
                                        <li><a href="">Aufbauleuchten</a></li>
                                        <li><a href="">Klemmleuchten</a></li>
                                    </ul>
                                </li>
                                <li><a href="">Tischleuchten</a></li>
                                <li><a href="">LED Tischleuchten</a></li>
                            </ul>
                        </li>
                        <li><a href="">Wandleuchten</a></li>
                        <li><a href="">Einbauleuchten</a></li>
                        <li><a href="">Unterbauleuchten</a></li>
                        <li><a href="">Aufbauleuchten</a></li>
                        <li><a href="">Bodenleuchten</a></li>
                        <li><a href="">Klemmleuchten</a></li>
                        <li><a href="">Lupenleuchten</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-md-9">
            


                <div class=" container-flex">
                    <div class="single-leftside inner inner-1">
                        <div class="row hidden-md-up">
                            <div class="col-xs-12">
                                <h1 class="h3 title">
                                    <span v-resource-bind:currentVariation="documents.0.data.variation.name" v-resource-if:currentVariation="documents[0].data.variation.name != ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>

                                    <span v-resource-if:currentVariation="documents[0].data.variation.name == ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>
                                </h1>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <item-image-carousel image-url-accessor="url"
                                                     template="#vue-item-image-carousel"></item-image-carousel>
                            </div>
                        </div>
                    </div>

                    <!-- ITEM DETAIL -->
                    <div class="single-rightside m-t-1 inner inner-2">
                        <div class="row">
                            <div class="col-xs-12">
                                <h6 class="producertag">
                                    <a href="#" class="producer text-muted">{{ item.documents[0].data.item.manufacturer.name }}</a>
                                </h6>

                                <h1 class="h3 title hidden-sm-down">
                                    <span v-resource-bind:currentVariation="documents.0.data.variation.name" v-resource-if:currentVariation="documents[0].data.variation.name != ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>

                                    <span v-resource-if:currentVariation="documents[0].data.variation.name == ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>
                                </h1>
                    
                                {% if ('item.shortDescription' in itemData or 'all' in itemData) and item.documents[0].data.texts[0].shortDescription != '' %}
                                    <p class="single-description hidden-sm-down">{{ item.documents[0].data.texts[0].shortDescription }}</p>
                                {% endif %}
                                
                                <div class="m-b-3">
                                    <span class="articlenumber">
                                        <b>{{ trans("Ceres::Template.itemNumber") }}</b>
                                        <span v-resource-bind:currentVariation="documents.0.data.variation.number">{{ item.documents[0].data.variation.number }}</span>
                                    </span>
                                </div>

                                <div class="m-y-1">
                                    {{ LayoutContainer.show("Ceres::SingleItem.BeforePrice", item.documents[0].data) }}
                                    {% if ('item.recommendedPrice' in itemData or 'all' in itemData) %}
                                        <div class="crossprice" v-resource-if:currentVariation="documents[0].data.calculatedPrices.rrp.price > 0">
                                            <del class="text-muted small" v-resource-bind:currentVariation="documents.0.data.calculatedPrices.rrp.price" :filters="['currency']">
                                                {#{{ item.data.salesPrices[1].price | formatMonetary(item.variationRetailPrice.currency) }} TODO get correct currency#}
                                                {{ item.documents[0].data.calculatedPrices.rrp.price | formatMonetary(item.documents[0].data.calculatedPrices.rrp.currency) }}
                                            </del>
                                        </div>
                                    {% endif %}

                                    <span class="price h1">
                                        <span v-resource-bind:currentVariation="documents.0.data.calculatedPrices.default.price" :filters="['currency']">{{ item.documents[0].data.calculatedPrices.default.price | formatMonetary(item.documents[0].data.calculatedPrices.default.currency) }}</span>
                                        <sup>*</sup>
                                    </span>
                                    <span class="vat small text-muted">
                                        {{ trans("Ceres::Template.itemInclVAT") }} {{ trans("Ceres::Template.itemExclusive") }}
                                        <a href="#" title="{{ trans("Ceres::Template.itemShippingCosts") }}">{{ trans("Ceres::Template.itemShippingCosts") }}</a>
                                    </span>

                                    {% for availability in services.availability.getAvailabilities() %}
                                    <span class="availability tag availability_{{ availability.id }}" v-resource-if:currentVariation="documents[0].data.variation.availability.id == {{ availability.id }}">
                                        {{ availability.languages[0].name }}
                                    </span>
                                    {% endfor %}
                                    <div class="row">
                                        <add-to-basket template="#vue-add-to-basket" v-resource-push:item data-accessor="true"
                                                       resource="currentVariation" :show-quantity="true"></add-to-basket>
                                    </div>

                                </div>

                                 {% if ('item.shortDescription' in itemData or 'all' in itemData) and item.documents[0].data.texts[0].shortDescription != '' %}
                                    <p class="single-description hidden-md-up">{{ item.documents[0].data.texts[0].shortDescription }}</p>
                                {% endif %}
                            </div>
                        </div>


                        <h3>Ähnliche Artikel</h3>
                        <ul class="product-list crossselling-list row grid" v-facet-param-watcher>
                            {% for item in itemList %}
                                <li class="col-xs-6">
                                    {% include "Kiom::Category.Item.Partials.CategoryListItem" with { 'item': item } %}
                                </li>
                            {% endfor %}
                        </ul>


                        

                    </div><!-- ./ITEM DETAIL -->

                    <!-- ITEM DESCRIPTION -->
                    <div class="m-y-3 inner inner-3">

                        <ul class="nav nav-tabs" role="tablist">
                            {% if not item.documents[0].data.texts[0].description == '' and('item.description' in itemData or 'all' in itemData) %}
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#details-{{ item.documents[0].data.variation.id }}"
                                       role="tab">{{ trans("Ceres::Template.itemDescription") }}</a>
                                </li>
                            {% endif %}

                            {% if not item.documents[0].data.texts[0].technicalData == '' and('item.technical_data' in itemData or 'all' in itemData) %}
                                <li class="nav-item">
                                    <a class="nav-link" data-toggle="tab" href="#data-{{ item.documents[0].data.variation.id }}"
                                       role="tab">{{ trans("Ceres::Template.itemTechnicalData") }}</a>
                                </li>
                            {% endif %}

                            <li class="nav-item">
                                <a class="nav-link" data-toggle="tab" href="#assessments-details"
                                   role="tab">{{ trans("Ceres::Template.itemMoreDetails") }}</a>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane active" id="details-{{ item.documents[0].data.variation.id }}" role="tabpanel">
                                <div class="m-y-2">
                                    {{ item.documents[0].data.texts[0].description|raw }}
                                </div>
                            </div>
                            <div class="tab-pane" id="data-{{ item.data.variation.id }}" role="tabpanel">
                                <div class="m-y-2">
                                    {{ item.documents[0].data.texts[0].technicalData|raw }}
                                </div>
                            </div>

                            <div class="tab-pane" id="assessments-details" role="tabpanel">
                                <div class="m-y-2">
                                    <table class="table table-striped table-hover table-sm">
                                        <tbody>
                                        {% if 'item.id' in itemData or 'all' in itemData %}
                                            <tr>
                                                <td>{{ trans("Ceres::Template.itemId") }}</td>
                                                <td>{{ item.documents[0].data.item.id }}</td>
                                            </tr>
                                        {% endif %}

                                        {% if 'item.condition' in itemData or 'all' in itemData %}
                                            <tr>
                                                <td>{{ trans("Ceres::Template.itemCondition") }}</td>
                                                <td>{{ trans("Ceres::Template.itemNew") }}</td>
                                            </tr>
                                        {% endif %}

                                        {% if 'item.age_rating' in itemData or 'all' in itemData %}
                                            <tr>
                                                <td>{{ trans("Ceres::Template.itemAge") }}</td>
                                                <td>{{ trans("Ceres::Template.itemFSK", {"age": item.documents[0].data.item.ageRestriction }) }}</td>
                                            </tr>
                                        {% endif %}

                                        {% if ('item.external_id' in itemData or 'all' in itemData) %}
                                            <tr v-resource-if:currentVariation="documents[0].data.variation.externalId != ''">
                                                <td>{{ trans("Ceres::Template.itemExternalVariationId") }}</td>
                                                <td v-resource-bind:currentVariation="documents.0.data.variation.externalId">{{ item.documents[0].data.variation.externalId }}</td>
                                            </tr>
                                        {% endif %}

                                        {% if ('item.variation_model' in itemData or 'all' in itemData) %}
                                            <tr v-resource-if:currentVariation="documents[0].data.variation.model != ''">
                                                <td>{{ trans("Ceres::Template.itemModel") }}</td>
                                                <td v-resource-bind:currentVariation="documents.0.data.variation.model">{{ item.documents[0].data.variation.model }}</td>
                                            </tr>
                                        {% endif %}

                                        {% if ('item.manufacturer' in itemData or 'all' in itemData) and item.documents[0].data.item.manufacturer.name != '' %}
                                            <tr>
                                                <td>{{ trans("Ceres::Template.itemManufacturer") }}</td>
                                                <td>{{ item.documents[0].data.item.manufacturer.name }}</td>
                                            </tr>
                                        {% endif %}

                                        {% if ('item.producerCountry' in itemData or 'all' in itemData) and item.documents[0].data.item.producingCountryId != '' %}
                                            {% set country = services.country.getCountryName(item.documents[0].data.item.producingCountryId) %}
                                            <tr>
                                                <td>{{ trans("Ceres::Template.itemManufacturingCountry") }}</td>
                                                <td>{{ country }}</td>
                                            </tr>
                                        {% endif %}

                                        {% if 'item.variationBase_content' in itemData or 'all' in itemData %}
                                            <tr>
                                                <td>{{ trans("Ceres::Template.itemContent") }}</td>
                                                <td>{{ item.documents[0].data.unit.content|formatDecimal(0) }} {{ item.documents[0].data.unit.names.name }}</td>
                                            </tr>
                                        {% endif %}

                                        {% if ('item.weightG' in itemData or 'all' in itemData) and item.documents[0].data.variation.weightG != '' %}
                                            <tr v-resource-if:currentVariation="documents[0].data.variation.weightG != ''">
                                                <td>{{ trans("Ceres::Template.itemWeight") }}</td>
                                                <td v-resource-bind:currentVariation="documents.0.data.variation.weightG">{{ item.documents[0].data.variation.weightG }}g</td>
                                            </tr>
                                        {% endif %}

                                        {% if ('item.weightNetG' in itemData or 'all' in itemData) and item.documents[0].data.variation.weightNetG != '' %}
                                            <tr v-resource-if:currentVariation="documents[0].data.variation.weightNetG != ''">
                                                <td>{{ trans("Ceres::Template.itemNetWeight") }}</td>
                                                <td v-resource-bind:currentVariation="documents.0.data.variation.weightNetG">{{ item.documents[0].data.variation.weightNetG }}g</td>
                                            </tr>
                                        {% endif %}

                                        {% if ('item.variation_dimensions' in itemData or 'all' in itemData) %}
                                            <tr>
                                                <td>{{ trans("Ceres::Template.itemDimensions") }}</td>
                                                <td>
                                                    <span v-resource-bind:currentVariation="documents.0.data.variation.lengthMM">{{ item.documents[0].data.variation.lengthMM }}</span>&times;<!--
                                                    --><span v-resource-bind:currentVariation="documents.0.data.variation.widthMM">{{ item.documents[0].data.variation.widthMM }}</span>&times;<!--
                                                    --><span v-resource-bind:currentVariation="documents.0.data.variation.heightMM">{{ item.documents[0].data.variation.heightMM }}</span> mm
                                                </td>
                                            </tr>
                                        {% endif %}

                                        {% if ('item.customs_tariff_number' in itemData or 'all' in itemData) and item.documents[0].data.item.customsTariffNumber != '' %}
                                            <tr>
                                                <td>{{ trans("Ceres::Template.itemCustomsTariffNumber") }}</td>
                                                <td>{{ item.documents[0].data.item.customsTariffNumber }}</td>
                                            </tr>
                                        {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ./ITEM DESCRIPTION -->
                </div>
                

                <div class="row">
                    <div class="col-xs-12">
                        <h3>Zubehör</h3>
                        <ul class="product-list crossselling-list row grid" v-facet-param-watcher>
                            {% for item in itemList %}
                                <li class="col-xs-6 col-lg-3">
                                    {% include "Kiom::Category.Item.Partials.CategoryListItem" with { 'item': item } %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div><!-- ./Zubehör -->

                <div class="row prop-row m-y-2 sale-new">
                    <div class="col-xs-6">
                        <div class="prop-xs-6-4 prop-md-3-1">
                            <div class="prop-inner">
                                <a class="featured-sale-new" href="">

                                    <img src="https://unsplash.it/1200/600?image=1004" alt="First slide">
                                    <div class="featured-category-inner">
                                        <h4 class="featured-category-headline">
                                            <i class="fa fa-angle-double-right" aria-hidden="true"></i> New
                                        </h4>

                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-6">
                        <div class="prop-xs-6-4 prop-md-3-1">
                            <div class="prop-inner">
                                <a class="featured-sale-new" href="">

                                    <img src="https://unsplash.it/1200/600?image=1004" alt="First slide">
                                    <div class="featured-category-inner">
                                        <h4 class="featured-category-headline">
                                            <i class="fa fa-angle-double-right" aria-hidden="true"></i> Sale
                                        </h4>

                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div><!-- ./new-slae -->
                
                <div class="row">
                    <div class="col-xs-12">
                        <h3>Kunden kauften auch</h3>
                        <ul class="product-list crossselling-list row grid" v-facet-param-watcher>
                            {% for item in itemList %}
                                <li class="col-xs-6 col-lg-3">
                                    {% include "Kiom::Category.Item.Partials.CategoryListItem" with { 'item': item } %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div><!-- ./Kunden kauften auch -->


                <div class="row prop-row m-y-2 sale-new">
                    <div class="col-xs-12">
                        <div class="prop-xs-2-1 prop-md-4-1">
                            <div class="prop-inner">
                                <a class="featured-sale-new" href="">

                                    <img src="https://unsplash.it/1200/600?image=1004" alt="First slide">
                                    <div class="featured-category-inner">
                                        <h4 class="featured-category-headline">
                                            <i class="fa fa-angle-double-right" aria-hidden="true"></i> Zuletzt angesehene Kategorie
                                        </h4>

                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div><!-- ./Zuletzt gesehene Kategorie -->
                
                <div class="row">
                    <div class="col-xs-12">
                        <h3>Zuletzt angesehen</h3>
                        <ul class="product-list crossselling-list row grid" v-facet-param-watcher>
                            {% for item in itemList %}
                                <li class="col-xs-6 col-lg-3">
                                    {% include "Kiom::Category.Item.Partials.CategoryListItem" with { 'item': item } %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div><!-- ./Zuletzt angesehen -->

            </div>
        </div>
        <!-- CROSSSELLING -->
        {% if crossSellingList | length > 0 %}

            <div class="row m-y-3">
                <div class="col-xs-12">
                    <h3 class="m-b-1">{{ (crossSellingList|first).relationship }}</h3>
                </div>
                <div class="col-xs-12">
                    <ul class="crosssellers list-unstyled row">
                        {% for crossSellingItem in crossSellingList %}
                            <li class="col-xs-12 col-sm-6 col-md-6 col-lg-3">
                                {% include "Ceres::Category.Item.Partials.CategoryListItem" with { 'item': services.item.getItem(crossSellingItem.crossItemId) } %}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        {% endif %}
        <!-- ./CROSSSELLING -->

    </div>

{% endblock %}