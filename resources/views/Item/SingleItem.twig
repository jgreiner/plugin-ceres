{% extends getPartial('page-design') %}
{% import "Ceres::PageDesign.Macros.LayoutContainer" as LayoutContainer %}

{% set lang         = services.sessionStorage.getLang() %}

{% set itemData = config("Ceres.item.data") | split(', ') %}
{% set configItemName = config("Ceres.item.name") %}
{% set variations = services.item.getVariationAttributeMap( item.documents[0].data.item.id  ) %}
{% set basePriceList = getBasePriceList( services.item.getVariationList( item.documents[0].data.item.id  ) ) %}

{% set newId = services.category.get(244, lang) %}
{% set saleId = services.category.get(243, lang) %}

{% set paginatedResult      = services.itemLoader.loadForTemplate('Ceres::ItemList.ItemListView', itemLoaderPresets.categoryList, {'categoryId':21, 'page':1, 'items':4, 'facets': facetParams, 'sorting': itemSort}) %}

{% set itemList          = paginatedResult.documents %}

{% block PageBody %}

    {{ component( "Ceres::Item.Components.VariationSelect" ) }}
    {{ component( "Ceres::Item.Components.ItemImageCarousel" ) }}
    {{ component( "Kiom::Basket.Components.AddToBasket" ) }}

    <resource name="currentVariation" :data="{{ item | json_encode() }}"></resource>

    <div class="single container-max page-content">
        <div class="row">
            <div class="col-md-12">

                <a class="back-link" onclick="window.history.back()"><small><i class="fa fa-caret-left" aria-hidden="true"></i> Zurück zur Übersicht</small></a>

                <div class="row m-t-1">
                    <div class="col-md-7 single-leftside">
                        <div class="row hidden-md-up">
                            <div class="col-xs-12">
                                <h1 class="h3 title">
                                    <span v-resource-bind:currentVariation="documents.0.data.variation.name" v-resource-if:currentVariation="documents[0].data.variation.name != ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>

                                    <span v-resource-if:currentVariation="documents[0].data.variation.name == ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>
                                </h1>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <item-image-carousel image-url-accessor="url"
                                                     template="#vue-item-image-carousel"></item-image-carousel>
                            </div>
                        </div>
                    </div>

                    <!-- ITEM DETAIL -->
                    <div class="col-md-5 single-rightside m-t-1">
                        <div class="row">
                            <div class="col-xs-12">
                                <h6 class="producertag hidden-sm-down">
                                    <a href="#" class="producer text-muted">{{ item.documents[0].data.item.manufacturer.name }}</a>
                                </h6>

                                <h1 class="h3 title hidden-sm-down">
                                    <span v-resource-bind:currentVariation="documents.0.data.variation.name" v-resource-if:currentVariation="documents[0].data.variation.name != ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>

                                    <span v-resource-if:currentVariation="documents[0].data.variation.name == ''">
                                        {{ item.documents[0].data.texts | itemName(configItemName) }}
                                    </span>
                                </h1>
                    
                                {% if ('item.shortDescription' in itemData or 'all' in itemData) and item.documents[0].data.texts[0].shortDescription != '' %}
                                    <p class="single-description hidden-sm-down">{{ item.documents[0].data.texts[0].shortDescription }}</p>
                                {% endif %}

                                <div class="row">
                                    <div class="col-xs-6">

                                    {% set len = item.documents[0].data.images.all | length %}
                                    {% set len = len - 1 %}

                                        {% for prop in item.documents[0].data.properties %}
                                            {% if prop.group.backendName == 'Energieeffizienzklasse' %}
                                                <div class="eek-sign 
                                                {% if prop.property.names[0].name == 'A++' %}
                                                    eek-aaa
                                                {% elseif prop.property.names[0].name == 'A+' %}
                                                    eek-aa
                                                {% elseif prop.property.names[0].name == 'A' %}
                                                    eek-a
                                                {% elseif prop.property.names[0].name == 'B' %}
                                                    eek-b
                                                {% elseif prop.property.names[0].name == 'C' %}
                                                    eek-c
                                                {% elseif prop.property.names[0].name == 'D' %}
                                                    eek-d
                                                {% elseif prop.property.names[0].name == 'E' %}
                                                    eek-e
                                                {% elseif prop.property.names[0].name == 'EEK Skala' %}
                                                    hidden-xs-up
                                                {% endif %}">
                                                    <a href="{{ item.documents[0].data.images.all[len].url }}"
                                                        data-lightbox="{{ item.documents[0].data.variation.id }}">
                                                        <span>{{ prop.property.names[0].name }}</span>
                                                    </a>
                                                </div>
                                                
                                            {% endif %}
                                        {% endfor %}
                                        
                                        <span class="articlenumber small">
                                            <b>Art.-Nr.: </b>
                                            <span v-resource-bind:currentVariation="documents.0.data.variation.number">{{ item.documents[0].data.variation.number }}</span>
                                        </span>
                                        
                                        <div class="availability-wrapper">
                                        {% for availability in services.availability.getAvailabilities() %}
                                            <span class="availability tag availability_{{ availability.id }}" v-resource-if:currentVariation="documents[0].data.variation.availability.id == {{ availability.id }}">
                                                {{ item.documents[0].data.variation.availability.names[0].name }}
                                            </span>
                                        {% endfor %}

                                        </div>
                                        
                                    </div>
                                    <div class="col-xs-6">
                                        <h6 class="producertag hidden-md-up">
                                            <a href="#" class="producer text-muted">{{ item.documents[0].data.item.manufacturer.name }}</a>
                                        </h6>
                                        {% if ('item.recommendedPrice' in itemData or 'all' in itemData) %}
                                            <div class="crossprice" v-resource-if:currentVariation="documents[0].data.calculatedPrices.rrp.price > 0">
                                                <del class="small" v-resource-bind:currentVariation="documents.0.data.calculatedPrices.rrp.price" :filters="['currency']">
                                                    {#{{ item.data.salesPrices[1].price | formatMonetary(item.variationRetailPrice.currency) }} TODO get correct currency#}
                                                    {{ item.documents[0].data.calculatedPrices.rrp.price | formatMonetary(item.documents[0].data.calculatedPrices.rrp.currency) }}
                                                </del>
                                            </div>
                                        {% endif %}

                                        <span class="price h1">
                                            <span v-resource-bind:currentVariation="documents.0.data.calculatedPrices.default.price" :filters="['currency']">{{ item.documents[0].data.calculatedPrices.default.price | formatMonetary(item.documents[0].data.calculatedPrices.default.currency) }}</span>
                                            <sup>*</sup>
                                        </span>
                                        <span class="vat small text-muted">
                                            {{ trans("Ceres::Template.itemInclVAT") }} {{ trans("Ceres::Template.itemExclusive") }}
                                            <a href="/webshop/versand/" title="{{ trans("Ceres::Template.itemShippingCosts") }}">{{ trans("Ceres::Template.itemShippingCosts") }}</a>
                                        </span>

                                    </div>
                                </div>
                                
                                
                                
                                <add-to-basket template="#vue-add-to-basket" v-resource-push:item data-accessor="true" resource="currentVariation" :show-quantity="true"></add-to-basket>
                               

                                 {% if ('item.shortDescription' in itemData or 'all' in itemData) and item.documents[0].data.texts[0].shortDescription != '' %}
                                    <h3 class="hidden-md-up">Kurzbeschreibung</h3>
                                    <p class="single-description hidden-md-up">{{ item.documents[0].data.texts[0].shortDescription }}</p>
                                {% endif %}
                            </div>
                        </div>


                        <h3>Ähnliche Artikel</h3>
                        <ul class="product-list crossselling-list row grid">
                            {% for item in itemList %}
                                <li class="col-xs-6">
                                    {% include "Kiom::Category.Item.Partials.CrosssellingItem" with { 'item': item } %}
                                </li>
                            {% endfor %}
                        </ul>


                        

                    </div><!-- ./ITEM DETAIL -->

                    <!-- ITEM DESCRIPTION -->
                    <div class="col-md-7 m-y-3">

                        <ul class="nav nav-tabs" role="tablist">
                            {% if not item.documents[0].data.texts[0].description == '' and('item.description' in itemData or 'all' in itemData) %}
                                <li class="nav-item">
                                    <a class="nav-link active" data-toggle="tab" href="#details-{{ item.documents[0].data.variation.id }}"
                                       role="tab">{{ trans("Ceres::Template.itemDescription") }}</a>
                                </li>
                            {% endif %}
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane active" id="details-{{ item.documents[0].data.variation.id }}" role="tabpanel">
                                <div class="m-y-2">
                                    {{ item.documents[0].data.texts[0].description|raw }}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ./ITEM DESCRIPTION -->
                </div>
                

                <div class="row">
                    <div class="col-xs-12">
                        <h3>Zubehör</h3>
                        <ul class="product-list crossselling-list row grid">
                            {% for item in itemList %}
                                <li class="col-xs-6 col-lg-3">
                                    {% include "Kiom::Category.Item.Partials.CrosssellingItem" with { 'item': item } %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div><!-- ./Zubehör -->

                <div class="row prop-row m-y-2 sale-new">
                    <div class="col-xs-6">
                        <div class="prop-xs-6-4 prop-md-3-1">
                            <div class="prop-inner">
                                <a class="featured-sale-new" href="{{ services.category.getURL(newId, lang) }}">

                                    <img src="/documents/{{ newId.details[0].imagePath }}" alt="New">
                                    <div class="featured-category-inner">
                                        <h4 class="featured-category-headline">
                                            <i class="fa fa-angle-double-right" aria-hidden="true"></i> New
                                        </h4>

                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="col-xs-6">
                        <div class="prop-xs-6-4 prop-md-3-1">
                            <div class="prop-inner">
                                <a class="featured-sale-new" href="{{ services.category.getURL(saleId, lang) }}">

                                    <img src="/documents/{{ saleId.details[0].imagePath }}" alt="Sale">
                                    <div class="featured-category-inner">
                                        <h4 class="featured-category-headline">
                                            <i class="fa fa-angle-double-right" aria-hidden="true"></i> Sale
                                        </h4>

                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>


                </div>
                
                <div class="row">
                    <div class="col-xs-12">
                        <h3>Kunden kauften auch</h3>
                        <ul class="product-list crossselling-list row grid">
                            {% for item in itemList %}
                                <li class="col-xs-6 col-lg-3">
                                    {% include "Kiom::Category.Item.Partials.CrosssellingItem" with { 'item': item } %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div><!-- ./Kunden kauften auch -->


                <div class="row prop-row m-y-2 sale-new">
                    <div class="col-xs-12">
                        <div class="prop-xs-2-1 prop-md-4-1">
                            <div class="prop-inner">
                                <a class="featured-sale-new" href="">

                                    <img src="https://unsplash.it/1200/600?image=1004" alt="First slide">
                                    <div class="featured-category-inner">
                                        <h4 class="featured-category-headline">
                                            <i class="fa fa-angle-double-right" aria-hidden="true"></i> Zuletzt angesehene Kategorie
                                        </h4>

                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div><!-- ./Zuletzt gesehene Kategorie -->
                
                <div class="row">
                    <div class="col-xs-12">
                        <h3>Zuletzt angesehen</h3>
                        <ul class="product-list crossselling-list row grid">
                            {% for item in itemList %}
                                <li class="col-xs-6 col-lg-3">
                                    {% include "Kiom::Category.Item.Partials.CrosssellingItem" with { 'item': item } %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div><!-- ./Zuletzt angesehen -->

            </div>
        </div>
        
        

    </div>

{% endblock %}